---
phase: 08-admin-dashboard
plan: 08
type: execute
wave: 2
depends_on: ["08-01", "08-02"]
files_modified:
  - frontend/src/app/(admin)/admin/orders/page.tsx
  - frontend/src/app/(admin)/admin/orders/columns.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can view list of all orders/payments"
    - "Admin can filter orders by status"
    - "Admin can see payment details including user info"
    - "Order amounts display in IDR format"
  artifacts:
    - path: "frontend/src/app/(admin)/admin/orders/page.tsx"
      provides: "Orders list page with data table"
      contains: "DataTable"
    - path: "frontend/src/app/(admin)/admin/orders/columns.tsx"
      provides: "Order table column definitions"
      contains: "ColumnDef"
  key_links:
    - from: "frontend/src/app/(admin)/admin/orders/page.tsx"
      to: "/admin/orders"
      via: "API fetch"
      pattern: "getAdminOrders"
---

<objective>
Build orders/payment history interface with list view and status filtering.

Purpose: Enables admins to view order history and payment status (ADMN-03 requirement).

Output:
- Orders list page with DataTable
- Status filter (pending, settlement, capture, etc.)
- User info display for each order
</objective>

<execution_context>
@/Users/dio/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-admin-dashboard/08-RESEARCH.md
@.planning/phases/08-admin-dashboard/08-01-SUMMARY.md
@.planning/phases/08-admin-dashboard/08-02-SUMMARY.md

# Backend orders endpoint from Plan 01:
# GET /admin/orders returns { orders, total, page, limit }
# Each order includes user { name, email }
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create orders columns definition</name>
  <files>
    frontend/src/app/(admin)/admin/orders/columns.tsx
  </files>
  <action>
Create frontend/src/app/(admin)/admin/orders/columns.tsx:

```typescript
'use client'

import { ColumnDef } from '@tanstack/react-table'
import { Badge } from '@/components/ui/badge'
import { format } from 'date-fns'
import { id as idLocale } from 'date-fns/locale'
import type { AdminOrder } from '@/lib/api/admin'

// Status badge variants
function getStatusVariant(status: string) {
  switch (status) {
    case 'settlement':
    case 'capture':
      return 'default' // Success - green/primary
    case 'pending':
      return 'secondary' // Waiting - gray
    case 'deny':
    case 'cancel':
    case 'expire':
      return 'destructive' // Failed - red
    case 'refund':
      return 'outline' // Refunded - outline
    default:
      return 'secondary'
  }
}

// Format amount as IDR
function formatIDR(amount: number) {
  return new Intl.NumberFormat('id-ID', {
    style: 'currency',
    currency: 'IDR',
    minimumFractionDigits: 0,
  }).format(amount)
}

export const columns: ColumnDef<AdminOrder>[] = [
  {
    accessorKey: 'midtransOrderId',
    header: 'Order ID',
    cell: ({ row }) => (
      <span className="font-mono text-xs">
        {row.original.midtransOrderId.substring(0, 20)}...
      </span>
    ),
  },
  {
    accessorKey: 'user',
    header: 'Customer',
    cell: ({ row }) => (
      <div>
        <div className="font-medium">{row.original.user.name}</div>
        <div className="text-xs text-muted-foreground">{row.original.user.email}</div>
      </div>
    ),
  },
  {
    accessorKey: 'type',
    header: 'Type',
    cell: ({ row }) => (
      <Badge variant="outline">
        {row.original.type === 'subscription' ? 'Subscription' : 'Workshop'}
      </Badge>
    ),
  },
  {
    accessorKey: 'amount',
    header: 'Amount',
    cell: ({ row }) => formatIDR(row.original.amount),
  },
  {
    accessorKey: 'status',
    header: 'Status',
    cell: ({ row }) => (
      <Badge variant={getStatusVariant(row.original.status)}>
        {row.original.status}
      </Badge>
    ),
  },
  {
    accessorKey: 'paymentMethod',
    header: 'Method',
    cell: ({ row }) => row.original.paymentMethod || '-',
  },
  {
    accessorKey: 'createdAt',
    header: 'Date',
    cell: ({ row }) => format(new Date(row.original.createdAt), 'dd MMM yyyy HH:mm', { locale: idLocale }),
  },
]
```
  </action>
  <verify>
Columns export correctly. TypeScript compiles.
  </verify>
  <done>
Order columns defined with status badges, IDR formatting, user info, and date formatting.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create orders list page with status filter</name>
  <files>
    frontend/src/app/(admin)/admin/orders/page.tsx
  </files>
  <action>
Create frontend/src/app/(admin)/admin/orders/page.tsx:

```typescript
'use client'

import { useEffect, useState } from 'react'
import { DataTable } from '@/components/admin/DataTable'
import { columns } from './columns'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import type { AdminOrder } from '@/lib/api/admin'

const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000'

const statusOptions = [
  { value: 'all', label: 'All Statuses' },
  { value: 'pending', label: 'Pending' },
  { value: 'settlement', label: 'Settlement' },
  { value: 'capture', label: 'Capture' },
  { value: 'deny', label: 'Denied' },
  { value: 'cancel', label: 'Cancelled' },
  { value: 'expire', label: 'Expired' },
  { value: 'refund', label: 'Refunded' },
]

export default function OrdersPage() {
  const [orders, setOrders] = useState<AdminOrder[]>([])
  const [loading, setLoading] = useState(true)
  const [statusFilter, setStatusFilter] = useState('all')
  const [page, setPage] = useState(1)
  const [total, setTotal] = useState(0)
  const limit = 20

  async function fetchOrders() {
    setLoading(true)
    try {
      const params = new URLSearchParams({
        page: String(page),
        limit: String(limit),
      })
      if (statusFilter !== 'all') {
        params.set('status', statusFilter)
      }

      const res = await fetch(`${API_URL}/admin/orders?${params}`, {
        credentials: 'include',
      })

      if (res.ok) {
        const data = await res.json()
        setOrders(data.orders)
        setTotal(data.total)
      }
    } finally {
      setLoading(false)
    }
  }

  useEffect(() => {
    fetchOrders()
  }, [statusFilter, page])

  // Calculate summary stats from current page
  const successfulOrders = orders.filter(o => ['settlement', 'capture'].includes(o.status))
  const totalRevenue = successfulOrders.reduce((sum, o) => sum + o.amount, 0)

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold">Orders</h1>
        <p className="text-muted-foreground">
          View and manage payment history
        </p>
      </div>

      {/* Quick Stats */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm font-medium text-muted-foreground">
              Total Orders
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{total}</div>
          </CardContent>
        </Card>
        {/* Add more stats if needed */}
      </div>

      {/* Filters */}
      <div className="flex items-center gap-4">
        <Select value={statusFilter} onValueChange={(v) => { setStatusFilter(v); setPage(1); }}>
          <SelectTrigger className="w-48">
            <SelectValue placeholder="Filter by status" />
          </SelectTrigger>
          <SelectContent>
            {statusOptions.map(opt => (
              <SelectItem key={opt.value} value={opt.value}>
                {opt.label}
              </SelectItem>
            ))}
          </SelectContent>
        </Select>
      </div>

      {/* Orders Table */}
      {loading ? (
        <div className="text-center py-8 text-muted-foreground">Loading...</div>
      ) : (
        <DataTable columns={columns} data={orders} />
      )}

      {/* Pagination */}
      <div className="flex items-center justify-between">
        <p className="text-sm text-muted-foreground">
          Showing {orders.length} of {total} orders
        </p>
        <div className="flex gap-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => setPage(p => Math.max(1, p - 1))}
            disabled={page === 1}
          >
            Previous
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={() => setPage(p => p + 1)}
            disabled={orders.length < limit}
          >
            Next
          </Button>
        </div>
      </div>
    </div>
  )
}
```

Features:
- Status filter dropdown
- Pagination controls
- Order totals display
- Loading state
- User info in customer column
- Status badges with appropriate colors
  </action>
  <verify>
Orders page loads and displays. Status filter works. Pagination navigates.
  </verify>
  <done>
Orders list shows all payments with status filter, customer info, and pagination.
  </done>
</task>

</tasks>

<verification>
1. Orders list shows all payments
2. Status filter filters by payment status
3. Customer name and email display
4. Amount shows in IDR format
5. Pagination works correctly
</verification>

<success_criteria>
- Admin can view all orders in DataTable
- Admin can filter orders by status (pending, settlement, etc.)
- Each order shows customer name and email
- Amounts display in Indonesian Rupiah format
- Pagination allows navigating through orders
</success_criteria>

<output>
After completion, create `.planning/phases/08-admin-dashboard/08-08-SUMMARY.md`
</output>
