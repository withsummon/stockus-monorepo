---
phase: 08-admin-dashboard
plan: 03
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - frontend/src/app/(admin)/admin/page.tsx
  - frontend/src/components/admin/MetricCard.tsx
  - frontend/src/lib/api/admin.ts
autonomous: true

must_haves:
  truths:
    - "Admin dashboard displays total members count"
    - "Admin dashboard displays total revenue"
    - "Admin dashboard displays active subscriptions"
    - "Admin dashboard displays recent orders count"
  artifacts:
    - path: "frontend/src/app/(admin)/admin/page.tsx"
      provides: "Admin dashboard with metrics"
      contains: "MetricCard"
    - path: "frontend/src/components/admin/MetricCard.tsx"
      provides: "KPI display card"
      contains: "CardContent"
    - path: "frontend/src/lib/api/admin.ts"
      provides: "Admin API client functions"
      exports: ["getAdminMetrics"]
  key_links:
    - from: "frontend/src/app/(admin)/admin/page.tsx"
      to: "frontend/src/lib/api/admin.ts"
      via: "getAdminMetrics import"
      pattern: "getAdminMetrics"
    - from: "frontend/src/lib/api/admin.ts"
      to: "/admin/metrics"
      via: "fetch call"
      pattern: "fetch.*admin/metrics"
---

<objective>
Build the admin dashboard page with key performance metrics displayed in cards.

Purpose: Provides admins with at-a-glance view of important business metrics (ADMN-04 requirement). This is the landing page after admin login.

Output:
- Admin API client helper
- MetricCard component for KPI display
- Dashboard page showing 4 key metrics
</objective>

<execution_context>
@/Users/dio/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-admin-dashboard/08-RESEARCH.md
@.planning/phases/08-admin-dashboard/08-01-SUMMARY.md

# Backend endpoint created in Plan 01:
# GET /admin/metrics returns { metrics: { totalMembers, totalRevenue, activeSubscriptions, recentOrders } }

# Existing patterns:
@frontend/src/components/ui/card.tsx
@frontend/src/lib/auth/dal.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin API client</name>
  <files>
    frontend/src/lib/api/admin.ts
  </files>
  <action>
Create frontend/src/lib/api/admin.ts:

```typescript
import 'server-only'
import { cookies } from 'next/headers'

const API_URL = process.env.API_URL || 'http://localhost:3000'

async function adminFetch(path: string, options: RequestInit = {}) {
  const cookieStore = await cookies()
  const token = cookieStore.get('access_token')?.value

  const res = await fetch(`${API_URL}${path}`, {
    ...options,
    headers: {
      ...options.headers,
      Cookie: `access_token=${token}`,
    },
    cache: 'no-store',
  })

  if (!res.ok) {
    throw new Error(`Admin API error: ${res.status}`)
  }

  return res.json()
}

export interface AdminMetrics {
  totalMembers: number
  totalRevenue: number
  activeSubscriptions: number
  recentOrders: number
}

export async function getAdminMetrics(): Promise<AdminMetrics> {
  const data = await adminFetch('/admin/metrics')
  return data.metrics
}

// Type definitions for users and orders
export interface AdminUser {
  id: number
  email: string
  name: string
  tier: string
  isVerified: boolean
  createdAt: string
  subscription?: {
    status: string
    endDate: string
  } | null
}

export interface AdminOrder {
  id: number
  userId: number
  midtransOrderId: string
  type: string
  status: string
  amount: number
  paymentMethod: string | null
  createdAt: string
  paidAt: string | null
  user: {
    name: string
    email: string
  }
}

export async function getAdminUsers(page = 1, limit = 20, search?: string) {
  const params = new URLSearchParams({ page: String(page), limit: String(limit) })
  if (search) params.set('search', search)
  const data = await adminFetch(`/admin/users?${params}`)
  return data as { users: AdminUser[]; total: number; page: number; limit: number }
}

export async function getAdminOrders(page = 1, limit = 20, status?: string) {
  const params = new URLSearchParams({ page: String(page), limit: String(limit) })
  if (status) params.set('status', status)
  const data = await adminFetch(`/admin/orders?${params}`)
  return data as { orders: AdminOrder[]; total: number; page: number; limit: number }
}
```

Include type definitions for all admin data structures to enable type-safe usage across admin pages.
  </action>
  <verify>
TypeScript compiles. Functions are exported correctly.
  </verify>
  <done>
Admin API client with getAdminMetrics, getAdminUsers, getAdminOrders functions and type definitions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MetricCard component</name>
  <files>
    frontend/src/components/admin/MetricCard.tsx
  </files>
  <action>
Create frontend/src/components/admin/MetricCard.tsx:

```typescript
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { cn } from '@/lib/utils'

interface MetricCardProps {
  title: string
  value: string | number
  description?: string
  className?: string
}

export function MetricCard({ title, value, description, className }: MetricCardProps) {
  return (
    <Card className={cn(className)}>
      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
        <CardTitle className="text-sm font-medium text-muted-foreground">
          {title}
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="text-2xl font-bold">{value}</div>
        {description && (
          <p className="text-xs text-muted-foreground mt-1">
            {description}
          </p>
        )}
      </CardContent>
    </Card>
  )
}
```

Simple, clean design:
- Title in muted text at top
- Large bold value
- Optional description below
- Accepts className for customization
  </action>
  <verify>
Component renders correctly with test props.
  </verify>
  <done>
MetricCard component displays title, value, and optional description in a card layout.
  </done>
</task>

<task type="auto">
  <name>Task 3: Build dashboard page with metrics</name>
  <files>
    frontend/src/app/(admin)/admin/page.tsx
  </files>
  <action>
Update frontend/src/app/(admin)/admin/page.tsx:

```typescript
import { getAdminMetrics } from '@/lib/api/admin'
import { MetricCard } from '@/components/admin/MetricCard'

export default async function AdminDashboardPage() {
  const metrics = await getAdminMetrics()

  // Format revenue as IDR
  const formattedRevenue = new Intl.NumberFormat('id-ID', {
    style: 'currency',
    currency: 'IDR',
    minimumFractionDigits: 0,
  }).format(metrics.totalRevenue)

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-3xl font-bold">Admin Dashboard</h1>
        <p className="text-muted-foreground">
          Overview of key metrics
        </p>
      </div>

      {/* KPI Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <MetricCard
          title="Total Members"
          value={metrics.totalMembers}
          description="Users with member tier"
        />
        <MetricCard
          title="Total Revenue"
          value={formattedRevenue}
          description="Successful payments"
        />
        <MetricCard
          title="Active Subscriptions"
          value={metrics.activeSubscriptions}
          description="Currently active"
        />
        <MetricCard
          title="Recent Orders"
          value={metrics.recentOrders}
          description="Last 30 days"
        />
      </div>

      {/* Quick Links */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <Card className="p-4">
          <h3 className="font-semibold mb-2">Quick Actions</h3>
          <div className="space-y-2">
            <Link href="/admin/courses/new" className="block text-sm text-primary hover:underline">
              + Create Course
            </Link>
            <Link href="/admin/research/new" className="block text-sm text-primary hover:underline">
              + Create Research Report
            </Link>
            <Link href="/admin/templates/new" className="block text-sm text-primary hover:underline">
              + Upload Template
            </Link>
          </div>
        </Card>
      </div>
    </div>
  )
}
```

Add necessary imports: Link from next/link, Card from components/ui/card.

Page is a Server Component that:
- Fetches metrics on the server
- Displays 4 KPI cards in responsive grid
- Shows quick action links for common tasks
- Uses Indonesian locale for currency formatting
  </action>
  <verify>
Page renders without errors. Metrics display correctly. Build succeeds.
  </verify>
  <done>
Admin dashboard shows 4 metric cards (members, revenue, subscriptions, orders) and quick action links.
  </done>
</task>

</tasks>

<verification>
1. Admin API client exports getAdminMetrics, getAdminUsers, getAdminOrders
2. MetricCard component renders title, value, description
3. Dashboard page fetches and displays all 4 metrics
4. Revenue formatted in IDR currency
5. Quick action links navigate to create pages
</verification>

<success_criteria>
- Dashboard shows Total Members count
- Dashboard shows Total Revenue in IDR format
- Dashboard shows Active Subscriptions count
- Dashboard shows Recent Orders count (last 30 days)
- Quick action links visible for creating content
</success_criteria>

<output>
After completion, create `.planning/phases/08-admin-dashboard/08-03-SUMMARY.md`
</output>
