---
phase: 08-admin-dashboard
plan: 05
type: execute
wave: 2
depends_on: ["08-01", "08-02"]
files_modified:
  - frontend/src/app/(admin)/admin/research/page.tsx
  - frontend/src/app/(admin)/admin/research/columns.tsx
  - frontend/src/app/(admin)/admin/research/new/page.tsx
  - frontend/src/app/(admin)/admin/research/[id]/page.tsx
  - frontend/src/lib/api/admin.ts
autonomous: true

must_haves:
  truths:
    - "Admin can view list of all research reports in a table"
    - "Admin can create a new research report"
    - "Admin can edit an existing research report"
    - "Admin can delete a research report"
  artifacts:
    - path: "frontend/src/app/(admin)/admin/research/page.tsx"
      provides: "Research list page with data table"
      contains: "DataTable"
    - path: "frontend/src/app/(admin)/admin/research/new/page.tsx"
      provides: "Create research form"
      contains: "useForm"
    - path: "frontend/src/app/(admin)/admin/research/[id]/page.tsx"
      provides: "Edit research form"
      contains: "useForm"
  key_links:
    - from: "frontend/src/app/(admin)/admin/research/page.tsx"
      to: "/research"
      via: "API fetch"
      pattern: "fetch.*research"
---

<objective>
Build research report management interface with list view, create form, and edit form.

Purpose: Enables admins to manage research reports (ADMN-01 requirement). Uses existing backend CRUD routes at /research.

Output:
- Research list page with DataTable
- Create research page with form (includes stock info fields)
- Edit research page with form
- Delete functionality
</objective>

<execution_context>
@/Users/dio/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-admin-dashboard/08-RESEARCH.md
@.planning/phases/08-admin-dashboard/08-01-SUMMARY.md
@.planning/phases/08-admin-dashboard/08-02-SUMMARY.md

# Backend research routes already exist:
@backend/src/routes/research.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add research API functions and types</name>
  <files>
    frontend/src/lib/api/admin.ts
  </files>
  <action>
Add to frontend/src/lib/api/admin.ts:

```typescript
// Research types
export interface Research {
  id: number
  title: string
  slug: string
  summary: string
  content: string
  thumbnailUrl: string | null
  publishedAt: string | null
  isFreePreview: boolean
  // Stock-specific fields (nullable)
  stockSymbol: string | null
  stockName: string | null
  stockRating: string | null // 'buy' | 'hold' | 'sell'
  targetPrice: number | null
  currentPrice: number | null
  createdAt: string
  updatedAt: string
}

export interface ResearchFormData {
  title: string
  summary?: string
  content?: string
  thumbnailUrl?: string | null
  isFreePreview?: boolean
  stockSymbol?: string | null
  stockName?: string | null
  stockRating?: string | null
  targetPrice?: number | null
  currentPrice?: number | null
}

export async function getAdminResearch() {
  const data = await adminFetch('/research')
  return data.reports as Research[]
}

export async function getAdminResearchById(id: number) {
  const data = await adminFetch(`/research/${id}`)
  return data.report as Research
}

export async function createResearch(data: ResearchFormData) {
  return adminFetch('/research', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data),
  })
}

export async function updateResearch(id: number, data: Partial<ResearchFormData>) {
  return adminFetch(`/research/${id}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data),
  })
}

export async function deleteResearch(id: number) {
  return adminFetch(`/research/${id}`, {
    method: 'DELETE',
  })
}
```
  </action>
  <verify>
TypeScript compiles. Functions exported.
  </verify>
  <done>
Research API functions added with full type definitions including stock info fields.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create research list page with DataTable</name>
  <files>
    frontend/src/app/(admin)/admin/research/page.tsx
    frontend/src/app/(admin)/admin/research/columns.tsx
  </files>
  <action>
1. Create frontend/src/app/(admin)/admin/research/columns.tsx:

Column definitions:
- title: Report title
- stockSymbol: Stock ticker (show "-" if null)
- stockRating: Badge with buy/hold/sell variant colors
- isFreePreview: Access level badge
- publishedAt: Date formatted
- actions: Edit/Delete dropdown

Rating badge colors:
- buy: default (primary)
- hold: secondary
- sell: destructive

2. Create frontend/src/app/(admin)/admin/research/page.tsx:

Client component that:
- Fetches research reports on mount
- Renders DataTable with columns
- "Add Research" button linking to /admin/research/new
- Handles delete with confirmation
- Search by title

Follow same pattern as courses list page.
  </action>
  <verify>
Research list renders. Stock rating badges display correctly.
  </verify>
  <done>
Research list shows all reports with stock info columns and appropriate badge styling.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create research create/edit forms</name>
  <files>
    frontend/src/app/(admin)/admin/research/new/page.tsx
    frontend/src/app/(admin)/admin/research/[id]/page.tsx
  </files>
  <action>
1. Create frontend/src/app/(admin)/admin/research/new/page.tsx:

Zod schema:
```typescript
const researchSchema = z.object({
  title: z.string().min(3).max(255),
  summary: z.string().optional(),
  content: z.string().optional(),
  thumbnailUrl: z.string().url().optional().nullable().or(z.literal('')),
  isFreePreview: z.boolean().default(false),
  // Stock info section (all optional)
  stockSymbol: z.string().max(10).optional().nullable().or(z.literal('')),
  stockName: z.string().max(255).optional().nullable().or(z.literal('')),
  stockRating: z.enum(['buy', 'hold', 'sell']).optional().nullable(),
  targetPrice: z.number().positive().optional().nullable(),
  currentPrice: z.number().positive().optional().nullable(),
})
```

Form layout:
- Basic Info section:
  - Title (required)
  - Summary (textarea)
  - Content (larger textarea)
  - Thumbnail URL
  - Free Preview checkbox

- Stock Analysis section (collapsible or separate card):
  - Stock Symbol (e.g., AAPL)
  - Stock Name (e.g., Apple Inc.)
  - Rating (select: Buy/Hold/Sell)
  - Target Price (number input)
  - Current Price (number input)

Note: Stock fields are all optional. Many research reports may not be about specific stocks.

2. Create frontend/src/app/(admin)/admin/research/[id]/page.tsx:

Same as new page but:
- Fetch existing data
- Pre-populate form
- PATCH on submit

Handle null values for stock fields by converting empty strings to null on submit.
  </action>
  <verify>
Create and edit forms work. Stock fields are optional and save correctly.
  </verify>
  <done>
Research create/edit forms with basic info and optional stock analysis sections.
  </done>
</task>

</tasks>

<verification>
1. Research list shows all reports with stock info columns
2. Rating badges have correct colors (buy/hold/sell)
3. Create form submits with or without stock fields
4. Edit form loads and updates correctly
5. Delete removes research from list
</verification>

<success_criteria>
- Admin can view all research reports in DataTable
- Admin can create new research with optional stock analysis
- Admin can edit existing research
- Admin can delete research
- Stock rating displays with color-coded badges
</success_criteria>

<output>
After completion, create `.planning/phases/08-admin-dashboard/08-05-SUMMARY.md`
</output>
